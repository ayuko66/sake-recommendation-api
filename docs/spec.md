# 日本酒レコメンドシステム MVP

仕様書 / 設計書

---

## 1. 仕様書 (WHAT)

### 1.1 プロダクト概要

#### 一文定義

ユーザーの嗜好(料理・食材・自然文)から  
**日本酒の味の方向性を推定し、ミスマッチを防ぐレコメンドAPI**

#### 想定ユーザー

- 日本酒EC運営者
- オンライン販売を行う酒屋
- 将来的には一般ユーザー向けアプリも想定

---

### 1.2 解決したい課題

- 味のイメージ違いによる「ハズレ購入」
- 初見銘柄が選びにくい問題
- 日本酒の専門用語が分からなくても選びたい

---

### 1.3 MVPのゴール

- GitHub公開できるポートフォリオ
- FastAPI + ML/LLM/NLP を使った実用的API
- レコメンド設計の思考プロセスを示す

---

### 1.4 スコープ (MVP)

#### やること

- 自由文(料理・食材・好み)から日本酒をレコメンド
- 出力は **「銘柄名」まで固定**
- 全国の流通酒を対象(限定酒は除外)

#### やらないこと

- 価格最適化
- 在庫連動
- 精米歩合や酵母などの専門的説明

---

### 1.5 入力仕様

#### 入力例(自由文)

- 「白身魚とハーブ系の料理に合うお酒」
- 「甘すぎず、ワインっぽい日本酒が好き」
- 「寒菊ホワイトが好き」

---

### 1.6 味の方向性定義

MVPでは以下 **4軸** を扱う。

| 軸 | 値の例 |
| --- | --- |
| 甘口 ↔ 辛口 | -1.0 ～ 1.0 |
| 淡麗 ↔ 芳醇 | -1.0 ～ 1.0 |
| フルーティ度 | low / mid / high |
| モダン ↔ クラシック | -1.0 ～ 1.0 |

※ すべて **連続値 or 疑似連続値** で保持する

---

### 1.7 出力仕様

```json
{
  "input_text": "白身魚とハーブ系の料理に合う日本酒",
  "recommendations": [
    {
      "sake_id": 101,
      "name": "〇〇 純米吟醸",
      "similarity_score": 0.86,
      "taste_profile": {
        "sweet_dry": 0.2,
        "body": -0.4,
        "fruity": "high",
        "style": 0.6
      },
      "reason": "軽やかでフルーティな方向性が料理と相性が良いため"
    }
  ]
}

---

### 1.8 銘柄参照API仕様

#### 1.8.1 銘柄一覧・ページング

- **Endpoint**: `GET /sakes`
- **Query Parameters**:
  - `page`: ページ番号 (default: 1)
  - `limit`: 1ページあたりの件数 (default: 20, max: 100)

- **Response**:

  ```json
  {
    "items": [
      {
        "sake_id": 1,
        "name": "銘柄名",
        "brewery": "蔵元名",
        "prefecture": "都道府県"
      }
    ],
    "total": 100,
    "page": 1,
    "limit": 20
  }
  ```

#### 1.8.2 銘柄詳細

- **Endpoint**: `GET /sakes/{sake_id}`

- **Response**:

  ```json
  {
    "sake_id": 1,
    "name": "銘柄名",
    "brewery": "蔵元名",
    "prefecture": "都道府県",
    "rice": "使用米",
    "grade": "特定名称",
    "abv": 15.5,
    "taste_profile": {
      "sweet_dry": 0.2,
      "body": -0.4,
      "fruity": "high",
      "style": 0.6
    }
  }
  ```

#### 1.8.3 銘柄検索

- **Endpoint**: `GET /search`
- **Query Parameters**:
  - `q`: 検索キーワード (銘柄名または蔵元名)
  - `limit`: 最大件数 (default: 20)

- **Response**:

  ```json
  {
    "items": [
      {
        "sake_id": 1,
        "name": "銘柄名",
        "brewery": "蔵元名",
        "prefecture": "都道府県"
      }
    ]
  }
  ```

---

## 2. システム構成・設定

### 2.1 環境変数設定

APIの挙動を以下の環境変数で制御可能です。

| 変数名 | 説明 | デフォルト値 |
| --- | --- | --- |
| `SAKE_DB_PATH` | SQLiteデータベースファイルのパス | `var/sake.db` |
| `USE_EMBEDDING` | 埋め込みベクトル検索を使用するか (0: OFF, 1: ON) | `0` |
| `EMBED_PROVIDER` | ベクトル生成プロバイダ (`openai`, `sbert` 等) | `openai` |